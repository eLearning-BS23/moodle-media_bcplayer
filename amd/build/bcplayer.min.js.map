{"version":3,"sources":["../src/bcplayer.js"],"names":["define","$","Event","bcs","notifyVideoJS","e","nodes","find","addBack","each","index","video","$video","html","attr","removeAttr","window","requirejs","undef","config","paths","location","protocol","require","bc","player","controls","hasClass","removeClass","setUp","getLegacyEvents","done","events","document","on","FILTER_CONTENT_UPDATED"],"mappings":"AAuBAA,OAAM,2BAAC,CAAC,QAAD,CAAW,YAAX,CAAD,CAA2B,SAACC,CAAD,CAAIC,CAAJ,CAAc,IACvCC,CAAAA,CAAG,CAAG,EADiC,CAwBvCC,CAAa,CAAG,SAASC,CAAT,CAAYC,CAAZ,CAAmB,CAMnCA,CAAK,CAACC,IAAN,mCACKC,OADL,mCAESD,IAFT,CAEc,UAFd,EAE0BE,IAF1B,CAE+B,SAASC,CAAT,CAAgBC,CAAhB,CAAuB,CAC9C,GAAIC,CAAAA,CAAM,CAAGX,CAAC,CAAC,IAAD,CAAd,CACAW,CAAM,CAACC,IAAP,CAAY,EAAZ,EACAD,CAAM,CAACE,IAAP,CAAY,oBAAZ,CAAkCF,CAAM,CAACE,IAAP,CAAY,cAAZ,CAAlC,EACAF,CAAM,CAACE,IAAP,CAAY,mBAAZ,CAAiCF,CAAM,CAACE,IAAP,CAAY,aAAZ,CAAjC,EACAF,CAAM,CAACE,IAAP,CAAY,qBAAZ,CAAmCF,CAAM,CAACE,IAAP,CAAY,eAAZ,CAAnC,EACAF,CAAM,CAACG,UAAP,CAAkB,cAAlB,EACAH,CAAM,CAACG,UAAP,CAAkB,aAAlB,EACAH,CAAM,CAACG,UAAP,CAAkB,eAAlB,EAOJC,MAAM,CAACC,SAAP,CAAiBC,KAAjB,CAAuB,IAAvB,EAGAF,MAAM,CAACC,SAAP,CAAiBE,MAAjB,CAAwB,CACpBC,KAAK,CAAE,CACH,aAASC,QAAQ,CAACC,QAAlB,qCAAuDV,CAAM,CAACE,IAAP,CAAY,oBAAZ,CAAvD,aAA6FF,CAAM,CAACE,IAAP,CAAY,mBAAZ,CAA7F,sBADG,CADa,CAAxB,EAMAE,MAAM,CAACO,OAAP,CAAe,CAAC,IAAD,CAAf,CAAuB,SAACC,CAAD,CAAQ,CAE3BrB,CAAG,aAAMS,CAAM,CAACE,IAAP,CAAY,oBAAZ,CAAN,SAA0CF,CAAM,CAACE,IAAP,CAAY,mBAAZ,CAA1C,EAAH,CAAmFU,CAAnF,CAEAZ,CAAM,CAACE,IAAP,CAAY,cAAZ,CAA4BF,CAAM,CAACE,IAAP,CAAY,oBAAZ,CAA5B,EACAF,CAAM,CAACE,IAAP,CAAY,aAAZ,CAA2BF,CAAM,CAACE,IAAP,CAAY,mBAAZ,CAA3B,EACAF,CAAM,CAACE,IAAP,CAAY,eAAZ,CAA6BF,CAAM,CAACE,IAAP,CAAY,qBAAZ,CAA7B,EACAF,CAAM,CAACG,UAAP,CAAkB,oBAAlB,EACAH,CAAM,CAACG,UAAP,CAAkB,mBAAlB,EACAH,CAAM,CAACG,UAAP,CAAkB,qBAAlB,EACA,GAAIU,CAAAA,CAAM,CAAGtB,CAAG,aAAMS,CAAM,CAACE,IAAP,CAAY,cAAZ,CAAN,SAAoCF,CAAM,CAACE,IAAP,CAAY,aAAZ,CAApC,EAAH,CAAqEH,CAArE,CAAb,CACAc,CAAM,CAACC,QAAP,KACA,GAAID,CAAM,CAACE,QAAP,CAAgB,8BAAhB,CAAJ,CAAqD,CACjDF,CAAM,CAACG,WAAP,CAAmB,8BAAnB,CACH,CACJ,CAfD,CAgBH,CA1CD,CA2CH,CAzE0C,CA4E3C,MAAO,CACHC,KAAK,CArEG,QAARA,CAAAA,KAAQ,EAAW,CAEnBzB,CAAa,CAAC,IAAD,CAAOH,CAAC,CAAC,MAAD,CAAR,CAAb,CAEAC,CAAK,CAAC4B,eAAN,GAAwBC,IAAxB,CAA6B,SAASC,CAAT,CAAiB,CAC1C/B,CAAC,CAACgC,QAAD,CAAD,CAAYC,EAAZ,CAAeF,CAAM,CAACG,sBAAtB,CAA8C/B,CAA9C,CACH,CAFD,CAIH,CA4DM,CAKV,CAjFK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Brightcove Player javascript module.\n * @module     media_bcplayer/bcplayer\n * @package    media_bcplayer\n * @copyright   2020 Brain station 23 ltd. <https://brainstation-23.com/>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/event'], ($, Event) => {\n    var bcs = {};\n    /**\n     * Set-up.\n     *\n     * Adds the listener for the event to then notify video.js.\n     * @param {Function} executeonload function to execute when media_videojs/video is loaded\n     */\n    var setUp = function() {\n        // Notify Video.js about the nodes already present on the page.\n        notifyVideoJS(null, $('body'));\n        // We need to call popover automatically if nodes are added to the page later.\n        Event.getLegacyEvents().done(function(events) {\n            $(document).on(events.FILTER_CONTENT_UPDATED, notifyVideoJS);\n        });\n\n    };\n\n    /**\n     * Notify video.js of new nodes.\n     *\n     * @param {Event} e The event.\n     * @param {NodeList} nodes List of new nodes.\n     */\n    var notifyVideoJS = function(e, nodes) {\n        var selector = '.brightcove-video-js-container';\n        // Find the descendants matching the expected parent of the audio and video\n        // tags. Then also addBack the nodes matching the same selector. Finally,\n        // we find the audio and video tags contained in those parents. Kind thanks\n        // to jQuery for the simplicity.\n        nodes.find(selector)\n            .addBack(selector)\n                .find('video-js').each(function(index, video) {\n                var $video = $(this);\n                $video.html('');\n                $video.attr('data-store-account', $video.attr('data-account'));\n                $video.attr('data-store-player', $video.attr('data-player'));\n                $video.attr('data-store-video-id', $video.attr('data-video-id'));\n                $video.removeAttr('data-account');\n                $video.removeAttr('data-player');\n                $video.removeAttr('data-video-id');\n\n            // Undefine 'bc' module so it can be reset using the next player's values.\n            // Because Brightcove's script forces itself to be named 'bc' when called as\n            // An AMD module, you have to undefine it before calling a second 'bc' module\n            // With a different url. Simply changing the path and requiring it won't work.\n            // It has to be undef'd before a second call can be made.\n            window.requirejs.undef('bc');\n\n            // Set the 'bc' module path using this video's account and player ids.\n            window.requirejs.config({\n                paths: {\n                    'bc': `${location.protocol}//players.brightcove.net/${ $video.attr('data-store-account')}/${ $video.attr('data-store-player')}_default/index.min`\n                }\n            });\n            // After 1 second signal that the job is finished with an error\n            window.require(['bc'], (bc) => {\n                // Store the current bc in bcs, because we're going to undefine it.\n                bcs[`bc${$video.attr('data-store-account')}${$video.attr('data-store-player')}`] = bc;\n                // Initialize all the videos for this account.\n                $video.attr('data-account', $video.attr('data-store-account'));\n                $video.attr('data-player', $video.attr('data-store-player'));\n                $video.attr('data-video-id', $video.attr('data-store-video-id'));\n                $video.removeAttr('data-store-account');\n                $video.removeAttr('data-store-player');\n                $video.removeAttr('data-store-video-id');\n                var player = bcs[`bc${$video.attr('data-account')}${$video.attr('data-player')}`](video);\n                player.controls(true);\n                if (player.hasClass('vjs-play-button-shape-square')) {\n                    player.removeClass('vjs-play-button-shape-square');\n                }\n            });\n        });\n    };\n\n\n    return {\n        setUp: setUp\n    };\n\n\n});\n"],"file":"bcplayer.min.js"}